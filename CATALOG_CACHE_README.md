# Кэширование каталогов в localStorage

## Обзор

Добавлена функциональность сохранения информации о каталогах в localStorage браузера для улучшения производительности и работы в офлайн режиме.

## Функциональность

### Основные возможности

1. **Автоматическое кэширование** - данные каталогов автоматически сохраняются в localStorage при загрузке
2. **Приоритет кэша** - приложение сначала проверяет localStorage, затем обращается к серверу
3. **Автоматическое обновление** - устаревшие данные (старше 7 дней) автоматически удаляются
4. **Управление кэшем** - администраторы могут управлять кэшем через веб-интерфейс

### Типы кэшируемых данных

- **Основные каталоги** (`bifo_catalogs_main`) - главные каталоги для главной страницы
- **Мега-меню** (`bifo_catalogs_mega`) - полная структура каталогов для мега-меню
- **Структуры каталогов** (`bifo_catalogs_structure_{slug}`) - детальная структура каждого каталога

## API методов

### Сохранение в localStorage
```javascript
app.saveCatalogsToLocalStorage(catalogs, type)
```
- `catalogs` - массив данных каталогов
- `type` - тип данных ('main', 'mega', 'structure_{slug}')

### Загрузка из localStorage
```javascript
app.getCatalogsFromLocalStorage(type)
```
Возвращает кэшированные данные или `null` если данных нет или они устарели.

### Очистка кэша
```javascript
app.clearCatalogsFromLocalStorage(type)
app.clearAllCatalogCache()
```

### Принудительное обновление
```javascript
app.refreshCatalogs(type)
```
Очищает кэш и загружает свежие данные с сервера.

### Информация о кэше
```javascript
app.getCatalogCacheInfo()
```
Возвращает объект с информацией о всех кэшированных данных.

## Структура данных в localStorage

```json
{
  "catalogs": [...], // массив данных каталогов
  "timestamp": 1234567890, // время сохранения
  "version": "1.0" // версия формата данных
}
```

## Страница управления кэшем

Доступна по адресу `/catalog-cache.html`

### Возможности:
- Просмотр информации о кэшированных данных
- Статистика использования кэша
- Принудительное обновление отдельных типов данных
- Очистка всего кэша

## Логика работы

1. **При загрузке каталогов:**
   - Проверяется наличие актуальных данных в localStorage
   - Если данные есть и не устарели - используются они
   - Если данных нет или они устарели - запрос к серверу
   - Полученные данные сохраняются в localStorage

2. **При ошибках сервера:**
   - Используются mock-данные
   - Mock-данные также сохраняются в localStorage

3. **Автоматическая очистка:**
   - Данные старше 7 дней автоматически удаляются
   - При ошибках чтения localStorage данные удаляются

## Преимущества

- **Быстрая загрузка** - данные загружаются мгновенно из localStorage
- **Офлайн режим** - приложение работает без интернета
- **Снижение нагрузки на сервер** - меньше запросов к API
- **Улучшенный UX** - мгновенный отклик интерфейса

## Ограничения

- Размер localStorage ограничен (~5-10 МБ)
- Данные привязаны к домену браузера
- При очистке браузера кэш удаляется

## Отладка

Для отладки кэша используйте консоль браузера:

```javascript
// Просмотр информации о кэше
console.log(app.getCatalogCacheInfo());

// Очистка всего кэша
app.clearAllCatalogCache();

// Принудительное обновление
app.refreshCatalogs('main');
```

## Безопасность

- Данные хранятся только на клиенте
- Нет передачи чувствительной информации
- Автоматическая очистка устаревших данных
- Проверка целостности данных при чтении 